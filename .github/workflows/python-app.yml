name: Update solved.ac Stats

on:
  schedule:
    # ë§¤ì¼ ì˜¤ì „ 9ì‹œ(KST)ì— ì‹¤í–‰ (UTC 0ì‹œ)
    - cron: '0 0 * * *'
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ì˜µì…˜

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - name: Get solved.ac user info and problem stats
        id: solvedac
        run: |
          # BOJ ì‚¬ìš©ì ì´ë¦„ ì„¤ì •
          BOJ_USERNAME="rladydgnj"
          
          # solved.ac APIì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          USER_INFO=$(curl -s "https://solved.ac/api/v3/user/show?handle=${BOJ_USERNAME}")
          
          # í•„ìš”í•œ ì •ë³´ ì¶”ì¶œ
          TIER=$(echo $USER_INFO | jq -r '.tier')
          SOLVED_COUNT=$(echo $USER_INFO | jq -r '.solvedCount')
          RANK=$(echo $USER_INFO | jq -r '.rank')
          
          # í‹°ì–´ ì´ë¦„ ë§¤í•‘
          if [ "$TIER" -eq "0" ]; then
            TIER_NAME="Unrated"
          elif [ "$TIER" -le "5" ]; then
            TIER_NAMES=("" "Bronze V" "Bronze IV" "Bronze III" "Bronze II" "Bronze I")
            TIER_NAME="${TIER_NAMES[$TIER]}"
          elif [ "$TIER" -le "10" ]; then
            TIER_NAMES=("" "Silver V" "Silver IV" "Silver III" "Silver II" "Silver I")
            TIER_NAME="${TIER_NAMES[$TIER-5]}"
          elif [ "$TIER" -le "15" ]; then
            TIER_NAMES=("" "Gold V" "Gold IV" "Gold III" "Gold II" "Gold I")
            TIER_NAME="${TIER_NAMES[$TIER-10]}"
          elif [ "$TIER" -le "20" ]; then
            TIER_NAMES=("" "Platinum V" "Platinum IV" "Platinum III" "Platinum II" "Platinum I")
            TIER_NAME="${TIER_NAMES[$TIER-15]}"
          elif [ "$TIER" -le "25" ]; then
            TIER_NAMES=("" "Diamond V" "Diamond IV" "Diamond III" "Diamond II" "Diamond I")
            TIER_NAME="${TIER_NAMES[$TIER-20]}"
          elif [ "$TIER" -le "30" ]; then
            TIER_NAMES=("" "Ruby V" "Ruby IV" "Ruby III" "Ruby II" "Ruby I")
            TIER_NAME="${TIER_NAMES[$TIER-25]}"
          elif [ "$TIER" -eq "31" ]; then
            TIER_NAME="Master"
          else
            TIER_NAME="Unknown"
          fi
          
          # í˜„ì¬ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
          DATE=$(date '+%Y-%m-%d %H:%M:%S')
          
          # í•´ê²°í•œ ë¬¸ì œ í˜ì´ì§€ë³„ë¡œ ê°€ì ¸ì˜¤ê¸°
          echo "ì‚¬ìš©ìê°€ í•´ê²°í•œ ë¬¸ì œ ì •ë³´ ê°€ì ¸ì˜¤ëŠ” ì¤‘..."
          
          # í‹°ì–´ë³„ ë¬¸ì œ ìˆ˜ ì´ˆê¸°í™”
          BRONZE_COUNT=0
          SILVER_COUNT=0
          GOLD_COUNT=0
          PLATINUM_COUNT=0
          DIAMOND_COUNT=0
          RUBY_COUNT=0
          
          PAGE=1
          TOTAL_PROBLEMS=0
          
          while true; do
            PROBLEMS=$(curl -s "https://solved.ac/api/v3/search/problem?query=solved_by:${BOJ_USERNAME}&page=${PAGE}")
            COUNT=$(echo $PROBLEMS | jq '.count')
            ITEMS=$(echo $PROBLEMS | jq '.items')
            ITEMS_COUNT=$(echo $ITEMS | jq 'length')
            
            if [ $ITEMS_COUNT -eq 0 ]; then
              break
            fi
            
            # ë¬¸ì œë³„ í‹°ì–´ ì§‘ê³„
            for i in $(seq 0 $(($ITEMS_COUNT - 1))); do
              PROBLEM_TIER=$(echo $ITEMS | jq -r ".[$i].level")
              
              if [ $PROBLEM_TIER -ge 1 ] && [ $PROBLEM_TIER -le 5 ]; then
                BRONZE_COUNT=$((BRONZE_COUNT + 1))
              elif [ $PROBLEM_TIER -ge 6 ] && [ $PROBLEM_TIER -le 10 ]; then
                SILVER_COUNT=$((SILVER_COUNT + 1))
              elif [ $PROBLEM_TIER -ge 11 ] && [ $PROBLEM_TIER -le 15 ]; then
                GOLD_COUNT=$((GOLD_COUNT + 1))
              elif [ $PROBLEM_TIER -ge 16 ] && [ $PROBLEM_TIER -le 20 ]; then
                PLATINUM_COUNT=$((PLATINUM_COUNT + 1))
              elif [ $PROBLEM_TIER -ge 21 ] && [ $PROBLEM_TIER -le 25 ]; then
                DIAMOND_COUNT=$((DIAMOND_COUNT + 1))
              elif [ $PROBLEM_TIER -ge 26 ] && [ $PROBLEM_TIER -le 31 ]; then
                RUBY_COUNT=$((RUBY_COUNT + 1))
              fi
            done
            
            TOTAL_PROBLEMS=$((TOTAL_PROBLEMS + ITEMS_COUNT))
            
            if [ $TOTAL_PROBLEMS -ge $COUNT ]; then
              break
            fi
            
            PAGE=$((PAGE + 1))
          done
          
          TOTAL_BY_TIER=$((BRONZE_COUNT + SILVER_COUNT + GOLD_COUNT + PLATINUM_COUNT + DIAMOND_COUNT + RUBY_COUNT))
          
          # ì •ë³´ ì €ì¥
          echo "username=${BOJ_USERNAME}" >> $GITHUB_OUTPUT
          echo "tier_name=${TIER_NAME}" >> $GITHUB_OUTPUT
          echo "solved_count=${SOLVED_COUNT}" >> $GITHUB_OUTPUT
          echo "rank=${RANK}" >> $GITHUB_OUTPUT
          echo "date=${DATE}" >> $GITHUB_OUTPUT
          echo "bronze_count=${BRONZE_COUNT}" >> $GITHUB_OUTPUT
          echo "silver_count=${SILVER_COUNT}" >> $GITHUB_OUTPUT
          echo "gold_count=${GOLD_COUNT}" >> $GITHUB_OUTPUT
          echo "platinum_count=${PLATINUM_COUNT}" >> $GITHUB_OUTPUT
          echo "diamond_count=${DIAMOND_COUNT}" >> $GITHUB_OUTPUT
          echo "ruby_count=${RUBY_COUNT}" >> $GITHUB_OUTPUT
          echo "total_by_tier=${TOTAL_BY_TIER}" >> $GITHUB_OUTPUT

      - name: Create complete README
        run: |
          # ì „ì²´ README ë‚´ìš© ìƒì„±
          cat > README.md << EOL
          # ë°±ì¤€ ì•Œê³ ë¦¬ì¦˜ ë¬¸ì œ í’€ì´ ì €ì¥ì†Œ

          ì´ ì €ì¥ì†ŒëŠ” ë°±ì¤€ ì˜¨ë¼ì¸ ì €ì§€ì˜ ì•Œê³ ë¦¬ì¦˜ ë¬¸ì œ í’€ì´ë¥¼ ê¸°ë¡í•˜ê³  ê³µìœ í•˜ê¸° ìœ„í•œ ê³³ì…ë‹ˆë‹¤.

          ## ğŸ“Š solved.ac í†µê³„
          > ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${{ steps.solvedac.outputs.date }}

          [![solved.ac í”„ë¡œí•„](https://mazassumnida.wtf/api/v2/generate_badge?boj=rladydgnj)](https://solved.ac/profile/rladydgnj)

          ### ê¸°ë³¸ ì •ë³´
          - í‹°ì–´: ${{ steps.solvedac.outputs.tier_name }}
          - í•´ê²°í•œ ë¬¸ì œ ìˆ˜: ${{ steps.solvedac.outputs.solved_count }}ê°œ
          - ë­í‚¹: ${{ steps.solvedac.outputs.rank }}ìœ„

          ## ğŸš€ ì§„í–‰ ìƒí™©
          | ë‚œì´ë„ | í•´ê²°í•œ ë¬¸ì œ ìˆ˜ |
          |:-------:|:-------:|
          | ë¸Œë¡ ì¦ˆ | ${{ steps.solvedac.outputs.bronze_count }}ë¬¸ì œ |
          | ì‹¤ë²„ | ${{ steps.solvedac.outputs.silver_count }}ë¬¸ì œ |
          | ê³¨ë“œ | ${{ steps.solvedac.outputs.gold_count }}ë¬¸ì œ |
          | í”Œë˜í‹°ë„˜ | ${{ steps.solvedac.outputs.platinum_count }}ë¬¸ì œ |
          | ë‹¤ì´ì•„ëª¬ë“œ | ${{ steps.solvedac.outputs.diamond_count }}ë¬¸ì œ |
          | ë£¨ë¹„ | ${{ steps.solvedac.outputs.ruby_count }}ë¬¸ì œ |
          | **í•©ê³„** | **${{ steps.solvedac.outputs.total_by_tier }}ë¬¸ì œ** |

          ## ğŸ¯ ì†Œê°œ
          ë°±ì¤€ ì˜¨ë¼ì¸ ì €ì§€ì—ì„œ ì œê³µí•˜ëŠ” ë‹¤ì–‘í•œ ì•Œê³ ë¦¬ì¦˜ ë¬¸ì œë“¤ì„ í’€ê³  í•´ë‹¹ í’€ì´ ì½”ë“œë¥¼ ì €ì¥í•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤. ì•Œê³ ë¦¬ì¦˜ í•™ìŠµê³¼ ì½”ë”© í…ŒìŠ¤íŠ¸ ì¤€ë¹„ë¥¼ ìœ„í•œ ê°œì¸ ê¸°ë¡ìš©ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.

          ## ğŸ“‹ ë¬¸ì œ ë¶„ë¥˜
          ë¬¸ì œë“¤ì€ ë‹¤ìŒê³¼ ê°™ì€ ì•Œê³ ë¦¬ì¦˜ ìœ í˜•ìœ¼ë¡œ ë¶„ë¥˜ë©ë‹ˆë‹¤:

          * êµ¬í˜„ (Implementation)
          * ìë£Œêµ¬ì¡° (Data Structure)
          * ì •ë ¬ (Sorting)
          * ê·¸ë˜í”„ ì´ë¡  (Graph)
          * ê·¸ë¦¬ë”” ì•Œê³ ë¦¬ì¦˜ (Greedy)
          * ë‹¤ì´ë‚˜ë¯¹ í”„ë¡œê·¸ë˜ë° (Dynamic Programming)
          * ì´ë¶„ íƒìƒ‰ (Binary Search)
          * BFS/DFS
          * ë¸Œë£¨íŠ¸í¬ìŠ¤ (Brute Force)
          * ì‹œë®¬ë ˆì´ì…˜ (Simulation)

          ## ğŸ’» ì‚¬ìš© ì–¸ì–´
          * Python

          ## ğŸ” í’€ì´ ë°©ë²•
          ê° ë¬¸ì œ í´ë”ì—ëŠ” ë‹¤ìŒ ë‚´ìš©ì´ í¬í•¨ë©ë‹ˆë‹¤:

          1. ì†ŒìŠ¤ ì½”ë“œ íŒŒì¼
          2. ë¬¸ì œ ì„¤ëª… (ì„ íƒ ì‚¬í•­)
          3. ì ‘ê·¼ ë°©ë²• ë° ì•Œê³ ë¦¬ì¦˜ ì„¤ëª… (ì„ íƒ ì‚¬í•­)
          4. ì‹œê°„ ë³µì¡ë„ ë° ê³µê°„ ë³µì¡ë„ ë¶„ì„ (ì„ íƒ ì‚¬í•­)

          ![ì•Œê³ ë¦¬ì¦˜ ê³µë¶€](https://github.com/user-attachments/assets/69600399-5107-4edd-87aa-74b02de454e0)
          EOL

      - name: Commit and push changes
        run: |
          git config --local user.email "github-actions@github.com"
          git config --local user.name "GitHub Actions"
          
          git add README.md
          
          if git diff --staged --quiet; then
            echo "No changes to commit"
            exit 0
          fi
          
          git commit -m "Update README with solved.ac statistics and complete content"
          git push --force
